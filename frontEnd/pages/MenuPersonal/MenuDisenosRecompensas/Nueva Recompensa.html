<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nueva Recompensa</title>
    <link rel="stylesheet" href="Nueva Recompensa.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-logo">
            <img src="../../../assets/images/Logo.png" alt="Logo" class="logo">
        </div>
        <ul class="nav-links">
            <li><a href="../../Inicio/dashboard.html" class="dropbtn">Inicio</a></li>
            <!-- Profile and settings pages are not defined yet -->
            <li><a href="profile.html">Perfil</a></li>
            <li><a href="settings.html">Configuración</a></li>
            <li><a href="../../Bienvenida/landing.html">Cerrar Sesión</a></li>
        </ul>
    </nav>
    <main class="main">
        <section class="section-title">
            <h1 class="main-title">Nueva Recompensa</h1>
        </section>
    <div class="task-box">
        <!-- El proceso de crear recompensa, junto con la redireccion, esta pendiente de completarse -->
        <form id="new-reward">
            <label for="titulo">¿Qué recompensa estás agregando?</label>
            <input type="text" id="rewardname" name="rewardname" required>

            <label for="description">Descripción (Opcional)</label>
            <textarea id="description" name="description" class="textarea" required></textarea>

            <!-- Temporal, se cambiará por seleccion de imagen por medio de API externa-->
            <label for="imagen">URL de imagen de referencia (Opcional)</label>
            <input type="text" id="image_url" name="image_url">

            <button type="submit" class="btn">Crear Recompensa</button>
        </form>
    </div>  


    <script>

        function check_Image_URL(URL){
            const pattern = /^(https?:\/\/[^\s]+?\.(?:jpg|jpeg|png|gif|bmp|webp|svg|tiff))(?:\?[^\s]*)?$/i;
            return pattern.test(URL.trim())
        }

        const form1 = document.getElementById('new-reward')
        form1.addEventListener('submit', event => {
            event.preventDefault();

            const formData = new FormData(form1);

            const data = Object.fromEntries(formData);

            if (!check_Image_URL(formData.get("image_url"))) {
                alert("El texto que ha ingresado para la URL de la imagen es invalido, intentelo de nuevo");
            }
            else{

                fetch('http://localhost:8080/api/rewards/createReward', {
                    method: 'POST',
                    credentials: "include",
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(async response => {
                    return await response.json();
                })
                .then(data => {
                    if (data) {
                        alert("¡La plantilla de recompensa se ha creado con exito!")
                        window.location.href = "../Recompensas.html";
                    } else {
                        alert("Usted ya ha creado una plantilla de recompensa con este nombre, cambielo e intentelo de nuevo.");
                    }
                })
            }

        })

    </script>
</main>
</body>
</html>
