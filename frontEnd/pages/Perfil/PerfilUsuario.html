<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Perfil de Usuario</title>
    <link rel="stylesheet" href="PerfilUsuario.css">
    <script src="../../shared/components/navbarManager.js" defer></script>
</head>
<body>
    <special-navbar></special-navbar>
    <main class="main">
        <section class ="profile-title">
            <div class="profile-header">
                <div class="circle">
                    <img src="../../assets/images/profile-icon.png" alt="Icono de usuario" class="camera-icon">
                    <!--img src="../../assets/images/camera-icon.png" alt="Icono de usuario" class="camera-icon"-->
                    <!--input type="file" id="profile-picture-input" accept="image/*" style="display: none;"-->
                    <script>
                        /*
                        const circle = document.querySelector('.circle');
                        const fileInput = document.getElementById('profile-picture-input');
                        circle.addEventListener('click', () => {
                            fileInput.click();
                        });
                        fileInput.addEventListener('change', (event) => {
                            const file = event.target.files[0];
                            if (file) {
                                const reader = new FileReader();
                                reader.onload = (e) => {
                                    circle.style.backgroundImage = `url(${e.target.result})`;
                                    circle.style.backgroundSize = 'cover';
                                    circle.style.backgroundPosition = 'center';
                                };
                                reader.readAsDataURL(file);
                                const cameraIcon = document.querySelector('.camera-icon');
                                if (cameraIcon) {
                                    cameraIcon.style.display = 'none';
                                }
                            }
                        });
                        */
                    </script>
                </div>
                <div class="user-info">
                    <h1 class="user-name">Nombre del Usuario</h1>
                    <h2 class="user-email">correo@ejemplo.com</h2>
                </div>
            </div>
        </section>
        <div class="user-compartidos">
            <h2 class="compartidos-title" id="compartidos-title">Grupos Propios</h2>
            <div class="compartidos-list" id="grupos-propios">
            </div>
        </div>
        <div class="user-tasks">
            <h2 class="compartidos-title" id="ajenos-title">Grupos en los que esta asignado</h2>
            <div class="compartidos-list" id="grupos-ajenos">
            </div>
        </div>
        <div class="user-rewards">
            <h2 class="compartidos-title" id="tareas-asignadas-title">Tareas Asignadas</h2>
            <div class="compartidos-list" id="tareas-asignadas">
            </div>

        <script>
            window.onload = loadUserTitle();
            window.onload = loadUserWorkGroups();
            window.onload = loadUserWorkGroups2();
            window.onload = loadUserAssignedTasks();

            function loadUserTitle() {
                fetch("http://localhost:8080/api/Main/getActiveUser", {
                    method: "GET",
                    credentials: "include"
                })
                .then(async response => {
                    return await response.json();
                })
                .then(data => {
                    document.querySelector(".user-name").innerHTML = data.username;
                    document.querySelector(".user-email").innerHTML = data.email;
                })
            }
            
            function loadUserWorkGroups() {
                fetch("http://localhost:8080/api/workGroups/getUserWorkGroups", {
                    method: "GET",
                    credentials: "include"
                })
                .then(async response => {
                    return response.json();
                })
                .then(data => {
                    if (!Array.isArray(data)) {
                        console.log("The received data was not an array");
                    }
                    else{
                        const workGroupsPropios_container = document.getElementById("grupos-propios");
                        let data_array = Array.from(data);

                        if (data_array.length === 0) {
                            const empty_title = document.getElementById("compartidos-title")
                            empty_title.textContent = "El usuario no tiene grupos de trabajo propios";
                        }
                        else{                            
                            let cont = 1;
                            data_array.forEach(item => {
                                const compartidos_card = document.createElement("div");
                                compartidos_card.classList.add("compartidos-card");

                                const compartidos_item = document.createElement("div");
                                compartidos_item.classList.add("compartido-item");
                                compartidos_item.textContent = `Grupo ${cont}`;

                                const compartidos_nombre = document.createElement("p");
                                compartidos_nombre.classList.add("texto-descripcion");
                                compartidos_nombre.textContent = `${item.workgroup_name}`;

                                compartidos_card.appendChild(compartidos_item);
                                compartidos_card.appendChild(compartidos_nombre);
                                workGroupsPropios_container.appendChild(compartidos_card);

                                cont = cont + 1;
                            });
                        }
                    }
                })
            }

            function loadUserWorkGroups2() {
                fetch("http://localhost:8080/api/workGroups/getWorkerWorkGroups", {
                    method: "GET",
                    credentials: "include"
                })
                .then(async response => {
                    return response.json();
                })
                .then(data => {
                    if (!Array.isArray(data)) {
                        console.log("The received data was not an array");
                    }
                    else{
                        const workGroupsAjenos_container = document.getElementById("grupos-ajenos");
                        let data_array = Array.from(data);

                        if (data_array.length == 0) {
                            const empty_title = document.getElementById("ajenos-title")
                            empty_title.textContent = "El usuario no esta asignado a ningun otro grupo de trabajo";
                        }
                        else{                            
                            let cont = 1;
                            data_array.forEach(item => {
                                const compartidos_card = document.createElement("div");
                                compartidos_card.classList.add("compartidos-card");

                                const compartidos_item = document.createElement("div");
                                compartidos_item.classList.add("compartido-item");
                                compartidos_item.textContent = `Grupo ${cont}`;

                                const compartidos_nombre = document.createElement("p");
                                compartidos_nombre.classList.add("texto-descripcion");
                                compartidos_nombre.textContent = `${item.workgroup_name}`;

                                compartidos_card.appendChild(compartidos_item);
                                compartidos_card.appendChild(compartidos_nombre);
                                workGroupsAjenos_container.appendChild(compartidos_card);

                                cont = cont + 1;
                            });
                        }
                    }
                })
            }

            function loadUserAssignedTasks() {
                fetch("http://localhost:8080/api/Main/getUserAssignedTasks", {
                    method: "GET",
                    credentials: "include"
                })
                .then(async response => {
                    return response.json();
                })
                .then(data => {
                    if (!Array.isArray(data)) {
                        console.log("The received data was not an array");
                    }
                    else{
                        const assignedTasks_container = document.getElementById("tareas-asignadas");
                        let data_array = Array.from(data);

                        if (data_array.length == 0) {
                            const empty_title = document.getElementById("tareas-asignadas-title");
                            empty_title.textContent = "El usuario no tiene ninguna tarea asignada de momento";
                        }
                        else{                            
                            let cont = 1;
                            data_array.forEach(item => {
                                const compartidos_card = document.createElement("div");
                                compartidos_card.classList.add("compartidos-card");

                                const compartidos_item = document.createElement("div");
                                compartidos_item.classList.add("compartido-item");
                                compartidos_item.textContent = `Tarea ${cont}`;

                                const compartidos_nombre = document.createElement("p");
                                compartidos_nombre.classList.add("texto-descripcion");
                                compartidos_nombre.textContent = `${item.name}`;

                                const duracion = document.createElement("p");
                                duracion.classList.add("texto-descripcion");
                                duracion.textContent = `${item.startline}`.substring(0,5) + ` - ` + `${item.endline}`.substring(0,5);

                                compartidos_card.appendChild(compartidos_item);
                                compartidos_card.appendChild(compartidos_nombre);
                                compartidos_card.appendChild(duracion);
                                assignedTasks_container.appendChild(compartidos_card);

                                cont = cont + 1;
                            });
                        }
                    }
                })
            }
                
            
        </script>
    </main>