<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AÃ±adir Miembro de la Familia</title>
    <link rel="stylesheet" href="crearWorker.css">
</head>
<body>
  <div class="container">
    <a href="Principal Creacion Perfil.html" class="back-arrow">â†</a>
    
    <h2>AÃ±adir Trabajador al grupo de trabajo</h2>
    
    <form id="worker-fields-container">
      <div class="user">
        <div class="user-icon">ğŸ‘¤</div>
        <!--
        <input type="text" name="nombre" placeholder="Nombre del usuario">
        -->
      </div>

      <fieldset>
        <legend>Â¿Que clase de trabajador quieres crear?</legend>
        <div class="roles">
          <label for="usuario"><input type="radio" id="usuario" name="rol" checked> Usuario </label>
          <label for="invitado"><input type="radio" id="invitado" name="rol"> Invitado </label>
        </div>
      </fieldset>

      <section class="section-tasks">
        <div id="worker-fields-container">
          <input type="text" id="worker-name" name="worker_name">
        </div>
      </section>

      <button type="submit" id="submit-button">Crear</button>
    </form>
  </div>

  

  <script>
    const fields_container = document.getElementById("worker-fields-container");
    const user_name_text = document.getElementById("worker-name");

    function cargarDatosUsuario(){
      user_name_text.placeholder = "Nombre de usuario a aÃ±adir";
    }

    function cargarDatosInvitado(){
      user_name_text.placeholder = "Nombre del nuevo invitado";
    }

    const user_option = document.getElementById("usuario");
    const guest_option = document.getElementById("invitado");

    user_option.addEventListener("click", event => {
      cargarDatosUsuario();
    });

    guest_option.addEventListener("click", event => {
      cargarDatosInvitado();
    });

    cargarDatosUsuario();

    fields_container.addEventListener("submit", event => {
      event.preventDefault();

      let option = document.querySelector('input[name="rol"]:checked');

      if (option.id == "usuario") {
        const formData = new FormData(fields_container);
        formData.delete("rol");
        formData.append("user_name", formData.get("worker_name"));
        formData.delete("worker_name");

        const data = Object.fromEntries(formData);

        fetch("http://localhost:8080/api/workers/createWorkUser", {
          method: "POST",
          credentials: "include",
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        })
        .then(async response => {
          return await response.json();
        })
        .then(data => {
          console.log(data);
          if (data) {
            alert("El usuario se ha aÃ±adido al espacio de trabajo con exito");
            window.location.href = "menuActiveWorkGroup.html";
          }
          else{
            alert("El usuario que ha ingresado no existe o ya se encuentra en uso. Intentelo de nuevo");
          }
        })
      }

      else{
        const formData = new FormData(fields_container);
        formData.delete("rol");
        formData.append("guest_name", formData.get("worker_name"));
        formData.delete("worker_name");

        const data = Object.fromEntries(formData);

        fetch("http://localhost:8080/api/workers/createWorkGuest", {
          method: "POST",
          credentials: "include",
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        })
        .then(async response => {
          return await response.json();
        })
        .then(data => {
          console.log(data);
          if (data) {
            alert("El invitado se ha creado al espacio de trabajo con exito");
            window.location.href = "menuActiveWorkGroup.html";
          }
          else{
            alert("Este nombre de invitado ya se encuentra en uso. Intentelo de nuevo");
          }
        })
      }

    })

  </script>
</body>
</html>